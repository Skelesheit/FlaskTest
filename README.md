
# Flask Project

Этот проект представляет собой приложение на Flask, которое можно запустить как с помощью Poetry, так и через Docker.

## Требования

- Python 3.12+
- Poetry (если используете Poetry)
- Docker (если используете Docker)

## Установка

### 1. Установка через Poetry

1. Убедитесь, что у вас установлен [Poetry](https://python-poetry.org/docs/#installation).
2. Клонируйте репозиторий и перейдите в директорию проекта:
   ```bash
   git clone <URL_репозитория>
   cd <папка_проекта>
   ```
3. Установите зависимости:
   ```bash
   poetry install
   ```
4. Запустите приложение с помощью Poetry:
   ```bash
   poetry run flask run
   ```

   Приложение будет доступно по адресу `http://127.0.0.1:5000/`.

### 2. Установка через Docker

1. Клонируйте репозиторий и перейдите в директорию проекта:
   ```bash
   git clone <URL_репозитория>
   cd <папка_проекта>
   ```
2. Запустите контейнеры с помощью `docker-compose`:
   ```bash
   docker-compose up --build
   ```
3. Приложение будет доступно по адресу `http://127.0.0.1:5000/`.

## Эндпоинты

### 1. `/dadata/suggest/{inn}`

- **Метод**: `GET`
- **Описание**: Запрос по ИНН данных о юр. лице или ИП

### 2. `/user/register`

- **Метод**: `POST`
- **Описание**: Регистрирует нового пользователя.
- **Параметры**:
  - `email`: Электронная почта пользователя.
  - `password`: Пароль пользователя.
  - `captchaToken`: токен капчи от Яндекса
- **Пример запроса**:
  ```json
  {
    "email": "user@example.com",
    "password": "securepassword",
    "captchaToken": "string"
  
  }
  ```

### 3. `/user/login`

- **Метод**: `POST`
- **Описание**: Логин пользователя.
- **Параметры**:
  - `email`: Электронная почта пользователя.
  - `password`: Пароль пользователя.
- **Пример запроса**:
  ```json
  {
    "email": "user@example.com",
    "password": "securepassword"
  }
  ```
### 4. `/user/fill-data`

- **Метод**: `POST`
- **Описание**: Заполнение данных пользователя.
- **Параметры**: Зависит от модели пользователя (требуется авторизация).

### 5. `/auth/me`

- **Метод**: `GET`
- **Описание**: Получить информацию о текущем пользователе (требуется авторизация).

### 6. `/auth/logout`

- **Метод**: `GET`
- **Описание**: Получить информацию о текущем пользователе (требуется авторизация).

### 7. `/auth/refresh`

- **Метод**: `GET`
- **Описание**: обновление access токена при помощи refresh (refresh под капотом тоже обновляется).

### 8. `/mail/confirm/<token>`

- **Метод**: `GET`
- **Описание**: обновление access токена при помощи refresh (refresh под капотом тоже обновляется).

## Визуализация и откладка

Для тестирования эндпоинтов используется swagger UI v2
- **эндпоинты**: доступны по адресу /
- **авторизация по токенам**: доступна при помощи кнопки `Authorize` -
не забудьте при подстановке токена вставлять `Bearer <token>`

## Устройство приложения
Бекенд использует фреймворк `flask` и `flask-restx` -
основные файлы находятся в папке `src`:
- **auth/** - содержит функции для создания и валидации токена
    - `decorators` - декораторы __@auth_required__ - служит для аутентификации; __@user_verified__ - проверка верификации по email
    - `test_jwt` - тестирование jwt токена
    - `tokens` - генерация и валидация jwt токена
- **db/** - содержит функции ждя инициализации баз данных, моделей и сессий
    - `db` - инициализация сессии
    - `models` - основные модели баз данных, а также методы для работы с ORM
    - `enums` - стандартные python enums
- **handlers/** - стандартные flask views - обработчики эндпоинтов
[Перейти к разделу Визуализация и отладка](##Визуализация-и-откладка)
- **schemas/** - сериализаторы `marshmallow` (умеют создавать `sqlalchemy` models) 
- **services/** - связь со внешними сервисами
  - `captcha` - работа с `Яндекс` капчей
  - `dadata` - запросы к сервису `dadata` - для поиске информации о компании через ИНН
  - `mail` - создания писем и конфигурация почтового бота `gmail`
- **swagger_schemas/** - схемы для откладки `swagger`
- **utils** - другие функции (хеширование пароля при помощи `bcrypt`)
## Настройка базы данных

Если вы хотите настроить и применить миграции Alembic, используйте следующую команду:

1. Для запуска миграций через Docker: 
миграции через alembic делаются автоматически через скрипт init_db при сборке
    ```bash
    docker-compose up
    ```

2. Для запуска миграций через Poetry:
   ```bash
   poetry run alembic upgrade head
   ```

## Текущие проблемы
-  не работает верификация `yandex` капчи на бекенде

## Заключение

Этот проект настроен для использования как с Poetry, так и с Docker. Вы можете выбрать любой из методов для локальной разработки. 
Все эндпоинты доступны после того, как приложение запущено. Если у вас возникнут проблемы, не стесняйтесь обращаться к разработчикам.
